require "ast"

def parse(str)
  tokens = Lexer::tokenize(str.strip)
  Parser.reset_unused_count!
  ast = Parser.new(tokens).parse!
  AST::remove_numbers(ast)
end

def ast_eq(ast)
  eq(AST::remove_numbers(ast))
end

context "snapshot" do
  it "2022-01-20 15:40:00 -0500" do
    ast = parse("schema Point = [x, y]
Point([x, y]) := [1, 2]
print(x, y)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "Point", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "x" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "y" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } } }, { :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Point" }, :property => { :node_type => :str_lit, :value => "valid_q" } } }, :pass => [{ :node_type => :assign, :sym => "__VALUE", :expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "x", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "y", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }], :fail => [{ :node_type => :throw, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "Match error" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "x" }, { :node_type => :identifier_lookup, :sym => "y" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:40:43 -0500" do
    ast = parse("d := <h1></h1>")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "d", :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "h1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }])
  end
  it "2022-01-20 15:41:15 -0500" do
    ast = parse("val := nil
print(val.nil?())")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "val", :expr => { :node_type => :function_call, :args => [{ :node_type => :nil_lit }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Nil" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "val" }, :property => { :node_type => :str_lit, :value => "nil?" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:41:32 -0500" do
    ast = parse("obj.add
obj.add()")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "obj" }, :property => { :node_type => :str_lit, :value => "add" } } }, { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "obj" }, :property => { :node_type => :str_lit, :value => "add" } } }])
  end
  it "2022-01-20 15:41:47 -0500" do
    ast = parse("obj.add 1, 3")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "obj" }, :property => { :node_type => :str_lit, :value => "add" } } }])
  end
  it "2022-01-20 15:42:03 -0500" do
    ast = parse("num := 5.3
inspect.print num.to_i")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "num", :expr => { :node_type => :function_call, :args => [{ :node_type => :float_lit, :value => 5.3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Float" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "num" }, :property => { :node_type => :str_lit, :value => "to_i" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "inspect" }, :property => { :node_type => :str_lit, :value => "print" } } }])
  end
  it "2022-01-20 15:42:41 -0500" do
    ast = parse('"  ".trim')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "  " }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "trim" } } }])
  end
  it "2022-01-20 15:43:01 -0500" do
    ast = parse("print([[:a, 1]].to_r.to_l == [[:a, 1]])")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "to_r" } } }, :property => { :node_type => :str_lit, :value => "to_l" } } }, :property => { :node_type => :str_lit, :value => "__eq__" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:44:12 -0500" do
    ast = parse('a := 1

print("oh #{a} #{a + 1}")')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "a" }, :property => { :node_type => :str_lit, :value => "__plus__" } } }, :property => { :node_type => :str_lit, :value => "to_s" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => " " }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "a" }, :property => { :node_type => :str_lit, :value => "to_s" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "oh " }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:54:30 -0500" do
    ast = parse('v := {
  [1]: "this is ON",
  [false]: "off",
  sym: 3,
  ["str"]: 3
}
print(v)')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "v", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :int_lit, :line => 1, :column => 4, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Int" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "this is ON" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :bool_lit, :line => 2, :column => 4, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Bool" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "off" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 3, :column => 3, :value => "sym" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 4, :column => 4, :value => "str" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "v" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:54:43 -0500" do
    ast = parse("print({a: 3, b: 5}.to_l.to_r)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 7, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 13, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 5 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "to_l" } } }, :property => { :node_type => :str_lit, :value => "to_r" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:55:04 -0500" do
    ast = parse("[{ b: { a } }] := [{ b: { a: 1 } }]
print(a)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 21, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 26, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 3, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 8, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :identifier_lookup, :sym => "a" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :property => { :node_type => :str_lit, :value => "valid_q" } } }, :pass => [{ :node_type => :assign, :sym => "__VALUE", :expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 21, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 26, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }], :fail => [{ :node_type => :throw, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "Match error" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:55:21 -0500" do
    ast = parse("[x, y] := [1, 2]
print(x, y)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :identifier_lookup, :sym => "x" }, { :node_type => :identifier_lookup, :sym => "y" }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :property => { :node_type => :str_lit, :value => "valid_q" } } }, :pass => [{ :node_type => :assign, :sym => "__VALUE", :expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "x", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "y", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }], :fail => [{ :node_type => :throw, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "Match error" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "x" }, { :node_type => :identifier_lookup, :sym => "y" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:55:32 -0500" do
    ast = parse("[a] := [1]
print(a)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :identifier_lookup, :sym => "a" }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :property => { :node_type => :str_lit, :value => "valid_q" } } }, :pass => [{ :node_type => :assign, :sym => "__VALUE", :expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }], :fail => [{ :node_type => :throw, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "Match error" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:55:45 -0500" do
    ast = parse("[a, b] := [1, :two]
print(a, b)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "two" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :identifier_lookup, :sym => "a" }, { :node_type => :identifier_lookup, :sym => "b" }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :property => { :node_type => :str_lit, :value => "valid_q" } } }, :pass => [{ :node_type => :assign, :sym => "__VALUE", :expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "two" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "b", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }], :fail => [{ :node_type => :throw, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "Match error" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }, { :node_type => :identifier_lookup, :sym => "b" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:55:58 -0500" do
    ast = parse("{a} := {a: 3}
print(a)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 8, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 1, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :identifier_lookup, :sym => "a" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :property => { :node_type => :str_lit, :value => "valid_q" } } }, :pass => [{ :node_type => :assign, :sym => "__VALUE", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 8, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }], :fail => [{ :node_type => :throw, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "Match error" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:56:12 -0500" do
    ast = parse("val := case [1] of
  [a] => a
end

print(val)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "val", :expr => { :node_type => :case, :expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }, :cases => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "match_expr" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "match_expr" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :identifier_lookup, :sym => "a" } }] }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } } }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "val" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:59:44 -0500" do
    ast = parse('a := "#{if true :result end}"
print(a)')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :function, :args => [], :body => [{ :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => true }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } }, :pass => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "result" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } } }], :fail => [] }] } }, :property => { :node_type => :str_lit, :value => "to_s" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } } }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 15:59:57 -0500" do
    ast = parse('a := "string #{"inside"} outside"
print(a)')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => " outside" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "inside" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "to_s" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "string " }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } } }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-20 23:01:52 -0500" do
    ast = parse("console.log(<div>{[1, 2].map fn x => x * 3 end}</div>)
")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 0, :column => 24, :args => [{ :node_type => :function, :line => 0, :column => 29, :args => [{ :node_type => :function_argument, :line => 0, :column => 32, :sym => "x" }], :body => [{ :node_type => :return, :line => 0, :column => 39, :expr => { :node_type => :function_call, :line => 0, :column => 39, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :int_lit, :line => 0, :column => 41, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Int" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 0, :column => 37, :sym => "x" }, :line => 0, :column => 43, :property => { :line => 0, :column => 39, :node_type => :str_lit, :value => "__mult__" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => 0, :column => 18, :value => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :int_lit, :line => 0, :column => 19, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Int" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :int_lit, :line => 0, :column => 22, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Int" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => 0, :column => 24, :property => { :line => 0, :column => 25, :node_type => :str_lit, :value => "map" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "console" }, :property => { :node_type => :str_lit, :value => "log" } } }])
  end
  it "2022-01-21 10:37:49 -0500" do
    ast = parse('a := [1, 2, 3].filter #{ % > 1 }.map #{ % * 10 }

print(a)')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 10 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__ANON_SHORT_ID" }, :property => { :node_type => :str_lit, :value => "__mult__" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__ANON_SHORT_ID" }, :property => { :node_type => :str_lit, :value => "__gt__" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "filter" } } }, :property => { :node_type => :str_lit, :value => "map" } } } }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-21 10:46:49 -0500" do
    ast = parse("a := (false == true) || [1, 2].has?(2)
print(a)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "has?" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :paren_expr, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => true }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__eq__" } } } }, :property => { :node_type => :str_lit, :value => "__or__" } } } }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-21 11:06:19 -0500" do
    ast = parse("a := false == true || [1, 2].has?(4)
print(a)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 4 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "has?" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => true }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__eq__" } } }, :property => { :node_type => :str_lit, :value => "__or__" } } } }, { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-26 23:50:21 -0500" do
    ast = parse("a := [3, 3]
b := nil
print(a&.size, b&.size)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "b", :expr => { :node_type => :function_call, :args => [{ :node_type => :nil_lit }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Nil" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "a" }, :property => { :node_type => :str_lit, :value => "size" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "a" }, :property => { :node_type => :str_lit, :value => "__and__" } } }, { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "b" }, :property => { :node_type => :str_lit, :value => "size" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "b" }, :property => { :node_type => :str_lit, :value => "__and__" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-27 00:25:50 -0500" do
    ast = parse("print({ a: 3 } - [:a], { a: 3 } + { b: 4})")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 8, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__minus__" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 36, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 4 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 25, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-28 16:04:11 -0500" do
    ast = parse('d := <h1 name="hehe">
  testing
  <div> okkhmmmm...</div>
</h1>
document_body.append(d.to_dom)')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "d", :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "h1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "name" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 0, :column => 14, :value => "hehe" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "testing" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }, { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "okkhmmmm..." }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => 2, :column => 3 }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "d" }, :property => { :node_type => :str_lit, :value => "to_dom" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "document_body" }, :property => { :node_type => :str_lit, :value => "append" } } }])
  end
  it "2022-01-29 17:20:05 -0500" do
    ast = parse('f { a } = a
f [ a ] = a
print(f({ a: "oh" }), f(["yea"]))')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :line => 0, :column => 8, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 0, :column => 8, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => 0, :column => 2, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 4, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :line => 0, :column => 6, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 6, :value => nil }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 0, :column => 6, :sym => "Schema" }, :line => 0, :column => 6, :property => { :line => 0, :column => 6, :node_type => :str_lit, :value => "any" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 0, :column => 8, :sym => "Schema" }, :line => 0, :column => 8, :property => { :line => 0, :column => 8, :node_type => :str_lit, :value => "for" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 0, :column => 8, :sym => "Schema" }, :line => 0, :column => 8, :property => { :line => 0, :column => 8, :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :identifier_lookup, :sym => "a" } }] } }, { :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :line => 1, :column => 9, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 1, :column => 9, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => 1, :column => 3, :value => [{ :node_type => :function_call, :line => 1, :column => 7, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 1, :column => 7, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 1, :column => 7, :sym => "Schema" }, :line => 1, :column => 7, :property => { :line => 1, :column => 7, :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 1, :column => 9, :sym => "Schema" }, :line => 1, :column => 9, :property => { :line => 1, :column => 9, :node_type => :str_lit, :value => "for" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 1, :column => 9, :sym => "Schema" }, :line => 1, :column => 9, :property => { :line => 1, :column => 9, :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :identifier_lookup, :sym => "a" } }] } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 2, :column => 11, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "oh" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :identifier_lookup, :sym => "f" } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "yea" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :identifier_lookup, :sym => "f" } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 18:29:07 -0500" do
    ast = parse('class BaseNum val =
  to_s = @val.to_s

class Num < BaseNum =
  to_s_2 = @to_s() + " oh wow"

print(Num::new(3).to_s_2)
')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "BaseNum", :super_class => nil, :args => [{ :node_type => :function_argument, :sym => "val" }], :methods => [{ :node_type => :declare, :sym => "to_s", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :instance_lookup, :sym => "val" }, :property => { :node_type => :str_lit, :value => "to_s" } } } }] } }] }, { :node_type => :class, :sym => "Num", :super_class => "BaseNum", :args => [], :methods => [{ :node_type => :declare, :sym => "to_s_2", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => " oh wow" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_lookup, :sym => "to_s" } }, :property => { :node_type => :str_lit, :value => "__plus__" } } } }] } }] }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Num" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "to_s_2" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 18:38:16 -0500" do
    ast = parse("class Test =
  a = 3
  get_arg a = a

class TestB =
  a = 3
  get_method = a

print(
  Test.new.get_arg(5),
  TestB.new.get_method
)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Test", :super_class => nil, :args => [], :methods => [{ :node_type => :declare, :sym => "a", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "get_arg", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "a" } } } }] } }] }, { :node_type => :class, :sym => "TestB", :super_class => nil, :args => [], :methods => [{ :node_type => :declare, :sym => "a", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "get_method", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "a" } } } }] } }] }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 5 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Test" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "get_arg" } } }, { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "TestB" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "get_method" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 18:38:43 -0500" do
    ast = parse("class Test =
  a = 3
  get_arg a = a
  get_method = a

print(
  Test.new.get_arg(50),
  Test.new.get_method
)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Test", :super_class => nil, :args => [], :methods => [{ :node_type => :declare, :sym => "a", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "get_arg", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "a" } } } }] } }, { :node_type => :declare, :sym => "get_method", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "a" } } } }] } }] }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 50 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Test" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "get_arg" } } }, { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Test" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "get_method" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 18:39:34 -0500" do
    ast = parse("class Test =
  f { b } = b

print(Test.new.f {b: 3})")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Test", :super_class => nil, :args => [], :methods => [{ :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 1, :column => 7, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => nil }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "b", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "b" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "b" } } } }] } }] }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 3, :column => 19, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Test" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "f" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 18:39:46 -0500" do
    ast = parse("class Test =
  f a = case a of
    {b} => b
  end

print(Test.new.f {b: 3})")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Test", :super_class => nil, :args => [], :methods => [{ :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :case, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "a" } } }, :cases => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 2, :column => 6, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => nil }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "match_expr" }], :body => [{ :node_type => :assign, :sym => "b", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "match_expr" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "b" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "b" } } } }] }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } } }] } }] }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 5, :column => 19, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Test" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "f" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 18:51:55 -0500" do
    ast = parse('class User < Element =
  view _ _ _ =
    <div>
      {props[:name]}
    </div>

class Main < Element =
  view _ _ _ =
    <User name="marcelle" />')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "User", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 3, :column => 14, :value => "name" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 3, :column => 8, :value => "props" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 3, :column => 8, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "props", :line => 3, :column => 8 } } }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "__lookup__" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [
                     { :node_type => :symbol, :value => "_5" },
                   ], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_5", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "name" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "marcelle" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "User" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }] }])
  end
  it "2022-01-29 19:09:07 -0500" do
    ast = parse("f =
  return 2 if true

print(f())")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => true }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } }, :pass => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } }], :fail => [] }] } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :identifier_lookup, :sym => "f" } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 19:09:57 -0500" do
    ast = parse("class Test =
  f =
    return 2 if a
    3

print(Test.new.f)")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Test", :super_class => nil, :args => [], :methods => [{ :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :if, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "a" } } }, :pass => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } }], :fail => [] }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }] }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Test" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "f" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 19:10:28 -0500" do
    ast = parse("class Main < Element =
  view _ _ _ =
    <div>
      this is my home page.&yo
    </div>")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "this is my home page.&yo" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-01-29 19:11:22 -0500" do
    ast = parse("class Child < Element =
  view { children } _ _ =
    <div>
      {children}
    </div>
  
class Main < Element =
  view _ _ _ =
    <Child>
      <span>
        child text
      </span>
    </Child>")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Child", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 1, :column => 10, :value => "children" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => nil }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "children", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "children" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 3, :column => 8, :value => "children" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 3, :column => 8, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "children", :line => 3, :column => 8 } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "children" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "span" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "child text" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Child" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }] }])
  end
  it "2022-01-29 19:11:55 -0500" do
    ast = parse('class Main < Element =
  style _ _ = "
    background: black;
    color: white;
    h1 {
      color: yellow;
    }
  "
  view _ _ _ =
    <div name={"ok"}>
      {"interp"}
      oh
      <h1>YELLOW</h1>
    </div>')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "\n    background: black;\n    color: white;\n    h1 {\n      color: yellow;\n    }\n  " }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "name" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 9, :column => 16, :value => "ok" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 10, :column => 8, :value => "interp" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, { :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "oh" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }, { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "h1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "YELLOW" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => 12, :column => 7 }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-01-29 19:12:29 -0500" do
    ast = parse("class Child < Element =
  view props _ _ =
    <div>
      {props[:children]}
    </div>
  
class Main < Element =
  view _ _ _ =
    <Child children={[<div>test</div>]}/>")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Child", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "props" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "props", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 3, :column => 14, :value => "children" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 3, :column => 8, :value => "props" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 3, :column => 8, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "props", :line => 3, :column => 8 } } }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "__lookup__" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "children" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "test" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Child" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }] }])
  end
  it "2022-01-29 19:13:11 -0500" do
    ast = parse('class Child < Element =
  init_state = false
  view props state _ =
    <div>
      <button onclick=#{set_state !state}>click me</button>
      {state}
      {props[:hmm]}
    </div>


class Main < Element =
  init_state = "wow"
  view _ state _ =
    set_timeout(#{set_state "oh"}, 2000)
    <div>
      <Child hmm={state}/>
    </div>')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Child", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "init_state", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "props" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "state" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "props", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "state", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "button" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "onclick" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function, :line => 4, :column => 23, :args => [{ :node_type => :function_argument, :line => 4, :column => 23, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :line => 4, :column => 23, :expr => { :node_type => :function_call, :line => 4, :column => 25, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 4, :column => 36, :value => "state" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 4, :column => 36, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "state", :line => 4, :column => 36 } } }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "bang" } } }], :expr => { :node_type => :instance_method_lookup, :sym => "set_state", :line => 4, :column => 25 } } }] } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "click me" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => 4, :column => 7 }, { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 5, :column => 8, :value => "state" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 5, :column => 8, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "state", :line => 5, :column => 8 } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 6, :column => 14, :value => "hmm" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 6, :column => 8, :value => "props" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 6, :column => 8, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "props", :line => 6, :column => 8 } } }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "__lookup__" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "init_state", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "wow" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "state" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "state", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "oh" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :instance_method_lookup, :sym => "set_state" } } }] }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2000 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :instance_method_lookup, :sym => "set_timeout" } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 15, :column => 7, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "hmm" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 15, :column => 19, :value => "state" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 15, :column => 19, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "state", :line => 15, :column => 19 } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 15, :column => 7, :sym => "Child" }, :line => nil, :column => nil, :property => { :line => 15, :column => 7, :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-01-29 19:13:56 -0500" do
    ast = parse('class Container < Element =
  style _ _ = "padding: 5% 20% 0 20%;"
  view _ _ _ = 
    <div>
      Marcelle Rusu
    </div>

class Main < Element =
  style _ _ = "
    background: rgb(248, 248, 255);
    width: 100%;
    height: 100%;
    font-family: \'Zen Kaku Gothic Antique\', sans-serif;
  "
  view _ _ _ =
    <div>
      <Container />
    </div>')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Container", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "padding: 5% 20% 0 20%;" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "Marcelle Rusu" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_5" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_6" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_5", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_6", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "\n    background: rgb(248, 248, 255);\n    width: 100%;\n    height: 100%;\n    font-family: 'Zen Kaku Gothic Antique', sans-serif;\n  " }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_7" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_8" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_9" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_7", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_8", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_9", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 16, :column => 7, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 16, :column => 7, :sym => "Container" }, :line => nil, :column => nil, :property => { :line => 16, :column => 7, :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-01-29 19:14:54 -0500" do
    File.write("rspec_child.pea", "
      export class Child < Element =
        style _ is_on = \"cursor: pointer;\"
        view _ _ _ = <div>child tests!</div>
      ".lstrip)
    ast = parse('import { Child } from "./rspec_child"

class Main < Element =
  style _ is_on = "cursor: pointer;"
  view _ _ _ = 
    <div>
      <Child />
    </div>')
    expect(ast).to ast_eq([{
                     :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } },
                   }, {
                     :node_type => :assign, :sym => "e1bd1dedc6d0c12bc5d9bb8f3be7645dc", :expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :function, :args => [], :body => [{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Child", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "is_on" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "is_on", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "cursor: pointer;" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :html_text_node, :value => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "child tests!" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :line => nil, :column => nil }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "Child" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :identifier_lookup, :sym => "Child" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "pea_module" }, :property => { :node_type => :str_lit, :value => "__unsafe_insert__" } } }, { :node_type => :return, :expr => { :node_type => :identifier_lookup, :sym => "pea_module" } }] } },
                   }, {
                     :node_type => :if, :expr => { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "e1bd1dedc6d0c12bc5d9bb8f3be7645dc" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 9, :value => "Child" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => nil }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :property => { :node_type => :str_lit, :value => "valid_q" } } }, :pass => [{ :node_type => :assign, :sym => "__VALUE", :expr => { :node_type => :identifier_lookup, :sym => "e1bd1dedc6d0c12bc5d9bb8f3be7645dc" } }, { :node_type => :assign, :sym => "Child", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "Child" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }], :fail => [{ :node_type => :throw, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "Match error" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }],
                   }, {
                     :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "is_on" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "is_on", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "cursor: pointer;" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_5" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_6" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_7" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_5", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_6", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_7", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 6, :column => 7, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 6, :column => 7, :sym => "Child" }, :line => nil, :column => nil, :property => { :line => 6, :column => 7, :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }],
                   }])
  end
  it "2022-01-29 19:15:34 -0500" do
    ast = parse('f 3 = "oh"
f a = a
f a b = a + b

print(f(5), f(3), f(3, 5))')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "oh" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :identifier_lookup, :sym => "a" } }] } }, { :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "b", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :identifier_lookup, :sym => "b" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "a" }, :property => { :node_type => :str_lit, :value => "__plus__" } } } }] } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 5 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :identifier_lookup, :sym => "f" } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :identifier_lookup, :sym => "f" } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 5 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :identifier_lookup, :sym => "f" } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 21:00:52 -0500" do
    ast = parse('class Test =
  f { a } = a
  f [a] = a

print(Test.new.f([1]), Test.new.f({ a: "oh"})) ')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Test", :super_class => nil, :args => [], :methods => [{ :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 1, :column => 7, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => nil }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "a" } } } }] } }, { :node_type => :declare, :sym => "f", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "a", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "a" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "a" } } } }] } }] }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Test" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "f" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 4, :column => 37, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "oh" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Test" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "f" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-01-29 22:44:12 -0500" do
    ast = parse('<div>{arr.map #{<Child text={%} />}}</div>')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 0, :column => 9, :args => [{ :node_type => :function, :line => 0, :column => 14, :args => [{ :node_type => :function_argument, :line => 0, :column => 14, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :line => 0, :column => 14, :expr => { :node_type => :function_call, :line => 0, :column => 16, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "text" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :identifier_lookup, :line => 0, :column => 29, :sym => "__ANON_SHORT_ID" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 0, :column => 16, :sym => "Child" }, :line => nil, :column => nil, :property => { :line => 0, :column => 16, :node_type => :str_lit, :value => "new" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => 0, :column => 6, :sym => "arr" }, :line => 0, :column => 9, :property => { :line => 0, :column => 10, :node_type => :str_lit, :value => "map" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } }])
  end
  it "2022-01-29 22:54:30 -0500" do
    ast = parse("<Child margin={i < l.last_index} />")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "margin" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "l" }, :property => { :node_type => :str_lit, :value => "last_index" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "i" }, :property => { :node_type => :str_lit, :value => "__lt__" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Child" }, :property => { :node_type => :str_lit, :value => "new" } } }])
  end
  it "2022-01-30 00:58:09 -0500" do
    ast = parse("<Child margin={i < l.last_index} other_prop={3} />")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "margin" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "l" }, :property => { :node_type => :str_lit, :value => "last_index" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "i" }, :property => { :node_type => :str_lit, :value => "__lt__" } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "other_prop" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Child" }, :property => { :node_type => :str_lit, :value => "new" } } }])
  end
  it "2022-02-01 01:19:45 -0500" do
    ast = parse('arr := [{ a: 5 }]
print(arr.find #{ %[:a] == 3 }&[:a])')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :assign, :sym => "arr", :expr => { :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => 0, :column => 10, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 5 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__ANON_SHORT_ID" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__eq__" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "arr" }, :property => { :node_type => :str_lit, :value => "find" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 3 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "a" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__ANON_SHORT_ID" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } }, :property => { :node_type => :str_lit, :value => "__eq__" } } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "arr" }, :property => { :node_type => :str_lit, :value => "find" } } }, :property => { :node_type => :str_lit, :value => "__and__" } } }], :expr => { :node_type => :identifier_lookup, :sym => "print" } }])
  end
  it "2022-02-03 17:54:05 -0500" do
    ast = parse("console.log 1.to_js, 2.to_js")
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "to_js" } } }, { :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "to_js" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "console" }, :property => { :node_type => :str_lit, :value => "log" } } }])
  end
  it "2022-02-07 13:47:36 -0500" do
    ast = parse('class Main < Element =
  style _ _ _ = "cursor: pointer;"
  init_state = false
  text val = 
    if val
      return "on"
    else
      return "off"
    end
  view _ is_on _ =
    f := #{@set_state(true)}
    <div onclick={f}>
      {text is_on}
    </div>')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "cursor: pointer;" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "init_state", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "text", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "val" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "val", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :if, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "val" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "val" } } }, :pass => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "on" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }], :fail => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "off" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "is_on" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "is_on", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "f", :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => true }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :instance_lookup, :sym => "set_state" } } }] } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "onclick" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 11, :column => 19, :value => "f" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 11, :column => 19, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "f", :line => 11, :column => 19 } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 12, :column => 8, :args => [{ :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 12, :column => 13, :value => "is_on" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 12, :column => 13, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "is_on", :line => 12, :column => 13 } } }], :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 12, :column => 8, :value => "text" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :instance_method_lookup, :sym => "text", :line => 12, :column => 8 } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-02-07 13:49:21 -0500" do
    ast = parse('class Main < Element =
  style _ _ _ = "cursor: pointer;"
  init_state = false
  text val = 
    if val
      return "this is ON"
    else
      return "off"
    end
  view _ is_on _ =
    <div onclick={#{set_state !is_on}}>
      {text is_on}
    </div>')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "cursor: pointer;" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "init_state", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "text", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "val" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "val", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :if, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "val" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "val" } } }, :pass => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "this is ON" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }], :fail => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "off" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "is_on" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "is_on", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "onclick" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function, :line => 10, :column => 19, :args => [{ :node_type => :function_argument, :line => 10, :column => 19, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :line => 10, :column => 19, :expr => { :node_type => :function_call, :line => 10, :column => 21, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 10, :column => 32, :value => "is_on" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 10, :column => 32, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "is_on", :line => 10, :column => 32 } } }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "bang" } } }], :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 10, :column => 21, :value => "set_state" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :instance_method_lookup, :sym => "set_state", :line => 10, :column => 21 } } } }] } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 11, :column => 8, :args => [{ :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 11, :column => 13, :value => "is_on" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 11, :column => 13, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "is_on", :line => 11, :column => 13 } } }], :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 11, :column => 8, :value => "text" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :instance_method_lookup, :sym => "text", :line => 11, :column => 8 } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-02-07 13:50:15 -0500" do
    ast = parse('class Main < Element =
  style _ _ _ = "cursor: pointer;"
  init_state = false
  text val =
    if val
      "this is ON"
    else
      "off"
    end
  view _ is_on _ =
    <div onclick=#{set_state !is_on}>
      {text is_on}
    </div>')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "cursor: pointer;" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "init_state", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "text", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "val" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "val", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :if, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "val" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "val" } } }, :pass => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "this is ON" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }], :fail => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "off" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "is_on" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_4" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "is_on", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_4", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "onclick" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function, :line => 10, :column => 18, :args => [{ :node_type => :function_argument, :line => 10, :column => 18, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :line => 10, :column => 18, :expr => { :node_type => :function_call, :line => 10, :column => 20, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 10, :column => 31, :value => "is_on" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 10, :column => 31, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "is_on", :line => 10, :column => 31 } } }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "bang" } } }], :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 10, :column => 20, :value => "set_state" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :instance_method_lookup, :sym => "set_state", :line => 10, :column => 20 } } } }] } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 11, :column => 8, :args => [{ :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 11, :column => 13, :value => "is_on" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 11, :column => 13, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "is_on", :line => 11, :column => 13 } } }], :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 11, :column => 8, :value => "text" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :instance_method_lookup, :sym => "text", :line => 11, :column => 8 } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-02-07 13:51:01 -0500" do
    ast = parse('class Main < Element =
  style _ is_on _ = "
    cursor: pointer;
    background: #{if is_on then "#f00" else "#fff" end};
  "
  init_state = false
  text val = {
    [true]: "this is ON",
    [false]: "off like off"
  }[val]
  view _ is_on _ =
    <div onclick=#{set_state !is_on}>
      {text is_on}
    </div>')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Main", :super_class => "Element", :args => [], :methods => [{ :node_type => :declare, :sym => "style", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_0" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "is_on" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_1" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_0", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "is_on", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_1", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => ";\n  " }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [], :expr => { :node_type => :function, :args => [], :body => [{ :node_type => :if, :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "is_on" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "is_on" } } }, :pass => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "#f00" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }], :fail => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "#fff" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } }] }] } }, :property => { :node_type => :str_lit, :value => "to_s" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "\n    cursor: pointer;\n    background: " }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } }, :property => { :node_type => :str_lit, :value => "__plus__" } } } }] } }, { :node_type => :declare, :sym => "init_state", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :bool_lit, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Bool" }, :property => { :node_type => :str_lit, :value => "new" } } } }] } }, { :node_type => :declare, :sym => "text", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "val" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "val", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :naked_or, :lhs => { :node_type => :function_call, :args => [{ :node_type => :function, :args => [], :body => [{ :node_type => :return, :expr => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "val" }], :expr => { :node_type => :identifier_lookup, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :sym => "__try" } }, :rhs => { :node_type => :function_call, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "val" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :bool_lit, :line => 7, :column => 6, :value => true }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Bool" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "this is ON" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :bool_lit, :line => 8, :column => 6, :value => false }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Bool" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function_call, :args => [{ :node_type => :str_lit, :value => "off like off" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Str" }, :property => { :node_type => :str_lit, :value => "new" } } } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }] } }, { :node_type => :declare, :sym => "view", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [{ :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_2" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "is_on" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }, { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :symbol, :value => "_3" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Sym" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "any" } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :assign, :sym => "_2", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 0 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "is_on", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :assign, :sym => "_3", :expr => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :int_lit, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Int" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "__VALUE" }, :property => { :node_type => :str_lit, :value => "__lookup__" } } } }, { :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "onclick" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function, :line => 11, :column => 18, :args => [{ :node_type => :function_argument, :line => 11, :column => 18, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :line => 11, :column => 18, :expr => { :node_type => :function_call, :line => 11, :column => 20, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 11, :column => 31, :value => "is_on" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 11, :column => 31, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "is_on", :line => 11, :column => 31 } } }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "bang" } } }], :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 11, :column => 20, :value => "set_state" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :instance_method_lookup, :sym => "set_state", :line => 11, :column => 20 } } } }] } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [{ :node_type => :function_call, :line => 12, :column => 8, :args => [{ :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 12, :column => 13, :value => "is_on" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :function_call, :line => 12, :column => 13, :args => [], :expr => { :node_type => :instance_method_lookup, :sym => "is_on", :line => 12, :column => 13 } } }], :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 12, :column => 8, :value => "text" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :instance_method_lookup, :sym => "text", :line => 12, :column => 8 } } }] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-02-07 13:52:31 -0500" do
    ast = parse('class Test =
  method =
    <div name=#{other_method 1, 2} />')
    expect(ast).to ast_eq([{ :node_type => :assign, :sym => "pea_module", :expr => { :node_type => :function_call, :args => [{ :node_type => :record_lit, :value => {} }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Record" }, :property => { :node_type => :str_lit, :value => "new" } } } }, { :node_type => :class, :sym => "Test", :super_class => nil, :args => [], :methods => [{ :node_type => :declare, :sym => "method", :schema => { :node_type => :function_call, :args => [{ :node_type => :function_call, :args => [{ :node_type => :array_lit, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "List" }, :property => { :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :sym => "Schema" }, :property => { :node_type => :str_lit, :value => "for" } } }, :expr => { :node_type => :function, :args => [{ :node_type => :function_argument, :sym => "__VALUE" }], :body => [{ :node_type => :return, :expr => { :node_type => :html_tag, :name => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => nil, :column => nil, :value => "div" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Str" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :attributes => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :record_lit, :line => nil, :column => nil, :value => { { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :symbol, :line => nil, :column => nil, :value => "name" }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Sym" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } => { :node_type => :function, :line => 2, :column => 15, :args => [{ :node_type => :function_argument, :line => 2, :column => 15, :sym => "__ANON_SHORT_ID" }], :body => [{ :node_type => :return, :line => 2, :column => 15, :expr => { :node_type => :function_call, :line => 2, :column => 17, :args => [{ :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :int_lit, :line => 2, :column => 30, :value => 1 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Int" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :int_lit, :line => 2, :column => 33, :value => 2 }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Int" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }], :expr => { :node_type => :naked_or, :lhs => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :function, :line => nil, :column => nil, :args => [], :body => [{ :node_type => :return, :line => nil, :column => nil, :expr => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :str_lit, :line => 2, :column => 17, :value => "other_method" }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "eval" } } }] }], :expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "__try" } }, :rhs => { :node_type => :instance_method_lookup, :sym => "other_method", :line => 2, :column => 17 } } } }] } } }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "Record" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } }, :children => { :node_type => :function_call, :line => nil, :column => nil, :args => [{ :node_type => :array_lit, :line => nil, :column => nil, :value => [] }], :expr => { :node_type => :property_lookup, :lhs_expr => { :node_type => :identifier_lookup, :line => nil, :column => nil, :sym => "List" }, :line => nil, :column => nil, :property => { :line => nil, :column => nil, :node_type => :str_lit, :value => "new" } } } } }] } }] }])
  end
  it "2022-02-07 14:03:22 -0500" do
    ast = parse('class Test =
  try_it_out =
    js_lookup console, "constructor", "name"

console.log Test.new.try_it_out ')
    expect(ast).to ast_eq([{:node_type=>:assign, :sym=>"pea_module", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}, {:node_type=>:class, :sym=>"Test", :super_class=>nil, :args=>[], :methods=>[{:node_type=>:declare, :sym=>"try_it_out", :schema=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:array_lit, :value=>[]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"List"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}, :expr=>{:node_type=>:function, :args=>[{:node_type=>:function_argument, :sym=>"__VALUE"}], :body=>[{:node_type=>:return, :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:naked_or, :lhs=>{:node_type=>:function_call, :args=>[{:node_type=>:function, :args=>[], :body=>[{:node_type=>:return, :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:str_lit, :value=>"console"}], :expr=>{:node_type=>:identifier_lookup, :sym=>"eval"}}}]}], :expr=>{:node_type=>:identifier_lookup, :sym=>"__try"}}, :rhs=>{:node_type=>:function_call, :args=>[], :expr=>{:node_type=>:instance_method_lookup, :sym=>"console"}}}, {:node_type=>:function_call, :args=>[{:node_type=>:str_lit, :value=>"constructor"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Str"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}, {:node_type=>:function_call, :args=>[{:node_type=>:str_lit, :value=>"name"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Str"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:naked_or, :lhs=>{:node_type=>:function_call, :args=>[{:node_type=>:function, :args=>[], :body=>[{:node_type=>:return, :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:str_lit, :value=>"js_lookup"}], :expr=>{:node_type=>:identifier_lookup, :sym=>"eval"}}}]}], :expr=>{:node_type=>:identifier_lookup, :sym=>"__try"}}, :rhs=>{:node_type=>:instance_method_lookup, :sym=>"js_lookup"}}}}]}}]}, {:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:function_call, :args=>[], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Test"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}, :property=>{:node_type=>:str_lit, :value=>"try_it_out"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"console"}, :property=>{:node_type=>:str_lit, :value=>"log"}}}])
  end
  it "2022-02-07 16:18:31 -0500" do
    ast = parse('f nil = true

print(f(nil))')
    expect(ast).to ast_eq([{:node_type=>:assign, :sym=>"pea_module", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}, {:node_type=>:declare, :sym=>"f", :schema=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:array_lit, :value=>[{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:nil_lit}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Nil"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"List"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}, :expr=>{:node_type=>:function, :args=>[{:node_type=>:function_argument, :sym=>"__VALUE"}], :body=>[{:node_type=>:return, :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:bool_lit, :value=>true}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Bool"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}]}}, {:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:nil_lit}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Nil"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:identifier_lookup, :sym=>"f"}}], :expr=>{:node_type=>:identifier_lookup, :sym=>"print"}}])
  end
  it "2022-02-07 21:17:04 -0500" do
    ast = parse('schema User = { id }

val := case { id: 4 }
of User({ id }) => id
end

print(val)')
    expect(ast).to ast_eq([{:node_type=>:assign, :sym=>"pea_module", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}, {:node_type=>:assign, :sym=>"User", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>0, :column=>16, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>nil}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"any"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}}, {:node_type=>:assign, :sym=>"val", :expr=>{:node_type=>:case, :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>2, :column=>15, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>4}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}, :cases=>{:node_type=>:function_call, :args=>[{:node_type=>:array_lit, :value=>[{:node_type=>:function_call, :args=>[{:node_type=>:array_lit, :value=>[{:node_type=>:function_call, :args=>[{:node_type=>:identifier_lookup, :sym=>"User"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}, {:node_type=>:function, :args=>[{:node_type=>:function_argument, :sym=>"match_expr"}], :body=>[{:node_type=>:assign, :sym=>"id", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"match_expr"}, :property=>{:node_type=>:str_lit, :value=>"__lookup__"}}}}, {:node_type=>:return, :expr=>{:node_type=>:identifier_lookup, :sym=>"id"}}]}]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"List"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"List"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}}, {:node_type=>:function_call, :args=>[{:node_type=>:identifier_lookup, :sym=>"val"}], :expr=>{:node_type=>:identifier_lookup, :sym=>"print"}}])
  end
  it "2022-02-07 21:21:10 -0500" do
    ast = parse('schema User = { id }

f User(a) = 3

print(f({ id: 3 }))')
    expect(ast).to ast_eq([{:node_type=>:assign, :sym=>"pea_module", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}, {:node_type=>:assign, :sym=>"User", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>0, :column=>16, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>nil}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"any"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}}, {:node_type=>:declare, :sym=>"f", :schema=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:array_lit, :value=>[{:node_type=>:function_call, :args=>[{:node_type=>:identifier_lookup, :sym=>"User"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"List"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}, :expr=>{:node_type=>:function, :args=>[{:node_type=>:function_argument, :sym=>"__VALUE"}], :body=>[{:node_type=>:assign, :sym=>"a", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>0}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"__VALUE"}, :property=>{:node_type=>:str_lit, :value=>"__lookup__"}}}}, {:node_type=>:return, :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>3}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}]}}, {:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>4, :column=>11, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>3}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:identifier_lookup, :sym=>"f"}}], :expr=>{:node_type=>:identifier_lookup, :sym=>"print"}}])
  end
  it "2022-02-07 21:27:57 -0500" do
    ast = parse('schema User = { id }

f User = 3

print(f({ id: 3 }))')
    expect(ast).to ast_eq([{:node_type=>:assign, :sym=>"pea_module", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}, {:node_type=>:assign, :sym=>"User", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>0, :column=>16, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>nil}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"any"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}}, {:node_type=>:declare, :sym=>"f", :schema=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:array_lit, :value=>[{:node_type=>:function_call, :args=>[{:node_type=>:identifier_lookup, :sym=>"User"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"List"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}, :expr=>{:node_type=>:function, :args=>[{:node_type=>:function_argument, :sym=>"__VALUE"}], :body=>[{:node_type=>:return, :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>3}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}]}}, {:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>4, :column=>11, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>3}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:identifier_lookup, :sym=>"f"}}], :expr=>{:node_type=>:identifier_lookup, :sym=>"print"}}])
  end
  it "2022-02-07 21:45:00 -0500" do
    ast = parse('schema User = { id }
f { user: User } = user

print(f({user: { id: 4 } }))')
    expect(ast).to ast_eq([{:node_type=>:assign, :sym=>"pea_module", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}, {:node_type=>:assign, :sym=>"User", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>0, :column=>16, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>nil}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"any"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}}, {:node_type=>:declare, :sym=>"f", :schema=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:array_lit, :value=>[{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>1, :column=>5, :value=>"user"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:identifier_lookup, :sym=>"User"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"List"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}, :expr=>{:node_type=>:function, :args=>[{:node_type=>:function_argument, :sym=>"__VALUE"}], :body=>[{:node_type=>:assign, :sym=>"user", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>"user"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>0}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"__VALUE"}, :property=>{:node_type=>:str_lit, :value=>"__lookup__"}}}, :property=>{:node_type=>:str_lit, :value=>"__lookup__"}}}}, {:node_type=>:return, :expr=>{:node_type=>:identifier_lookup, :sym=>"user"}}]}}, {:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>3, :column=>10, :value=>"user"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:symbol, :line=>3, :column=>18, :value=>"id"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Sym"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}=>{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>4}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:identifier_lookup, :sym=>"f"}}], :expr=>{:node_type=>:identifier_lookup, :sym=>"print"}}])
  end
  it "2022-02-07 22:20:53 -0500" do
    ast = parse('class Main < Element =
  view _ _ _ =
    <div>
      {if true then "ok" end}
    </div>')
    expect(ast).to ast_eq([{:node_type=>:assign, :sym=>"pea_module", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:record_lit, :value=>{}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Record"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}}, {:node_type=>:class, :sym=>"Main", :super_class=>"Element", :args=>[], :methods=>[{:node_type=>:declare, :sym=>"view", :schema=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:array_lit, :value=>[{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>"_0"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"any"}}}, {:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>"_1"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"any"}}}, {:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:symbol, :value=>"_2"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Sym"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"any"}}}]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"List"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Schema"}, :property=>{:node_type=>:str_lit, :value=>"for"}}}, :expr=>{:node_type=>:function, :args=>[{:node_type=>:function_argument, :sym=>"__VALUE"}], :body=>[{:node_type=>:assign, :sym=>"_0", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>0}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"__VALUE"}, :property=>{:node_type=>:str_lit, :value=>"__lookup__"}}}}, {:node_type=>:assign, :sym=>"_1", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>1}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"__VALUE"}, :property=>{:node_type=>:str_lit, :value=>"__lookup__"}}}}, {:node_type=>:assign, :sym=>"_2", :expr=>{:node_type=>:function_call, :args=>[{:node_type=>:function_call, :args=>[{:node_type=>:int_lit, :value=>2}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"Int"}, :property=>{:node_type=>:str_lit, :value=>"new"}}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :sym=>"__VALUE"}, :property=>{:node_type=>:str_lit, :value=>"__lookup__"}}}}, {:node_type=>:return, :expr=>{:node_type=>:html_tag, :name=>{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:str_lit, :line=>nil, :column=>nil, :value=>"div"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Str"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}, :attributes=>{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:record_lit, :line=>nil, :column=>nil, :value=>{}}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Record"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}, :children=>{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:array_lit, :line=>nil, :column=>nil, :value=>[{:node_type=>:function, :line=>nil, :column=>nil, :args=>[], :body=>[{:node_type=>:if, :line=>3, :column=>8, :expr=>{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:bool_lit, :line=>3, :column=>11, :value=>true}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Bool"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}, :pass=>[{:node_type=>:return, :line=>nil, :column=>nil, :expr=>{:node_type=>:function_call, :line=>nil, :column=>nil, :args=>[{:node_type=>:str_lit, :line=>3, :column=>21, :value=>"ok"}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"Str"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}}], :fail=>[]}]}]}], :expr=>{:node_type=>:property_lookup, :lhs_expr=>{:node_type=>:identifier_lookup, :line=>nil, :column=>nil, :sym=>"List"}, :line=>nil, :column=>nil, :property=>{:line=>nil, :column=>nil, :node_type=>:str_lit, :value=>"new"}}}}}]}}]}])
  end
end